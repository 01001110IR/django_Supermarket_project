<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/htmls/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<a href="login.html" class="nav-button">Login</a>
<a href="register.html" class="nav-button">Register</a>

<body>
    <div class="top-logo">
        <img src="/htmls/static/walmartLogo (1).svg" alt="Walmart Logo" height="30">
    </div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Product Page</a>
        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#products">Products</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#cart">Cart</a>
                </li>
                
                <li>
                    <div class="navbar-text ml-auto" id="navbar-total-price">Total Price: 0</div>
                </li>
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="#">  </a>
               
            </ul>
        </div>
    </nav>
    
    <div class="container tab-content">
        <div class="tab-pane active" id="products">
            <div id="display"></div>
        </div>
      
              
            </div>
        </div>
    </div>
    
    <div id="totalprice">
         <span id="total-amount" ></span>
    </div>
  
    <script>
        
        const cart = [];
        const MY_SERVER = "http://127.0.0.1:8000";
     
        const load_display = async () => {
            try {
                res = await axios.get(MY_SERVER + "/get/Product/");
                const display = document.getElementById("display");
                
                res.data.forEach(products => {
                    const productCard = document.createElement("div");
                    productCard.className = "product-card";

                    const image = document.createElement("img");
                    image.src = products.img;
                    image.alt = products.name;
                    image.className = "product-image";

                    // Generate a unique ID for the product
                    const productID = `product-${products.id}`;

                    const details = document.createElement("div");
                    details.className = "product-details";
                    details.innerHTML = `
                        <p> ${products.name}</p>
                        <p> ${products.price}$</p>
                        <p> Quantity: <span id="total-quantity-${productID}">0</span></p>
                        <button type="button" class="btn btn-outline-success" onclick="buyIthem(${products.id}, '${products.img}', '${products.name}', ${products.price}, '${productID}')" class="product-button">Add to cart</button>
                        <button type="button" class="btn btn-outline-danger" onclick="deleteIthem(${products.id}, '${products.img}', '${products.name}', ${products.price}, '${productID}')" class="product-button">Delete from cart</button>
                    `;

                    productCard.append(image, details);
                    display.appendChild(productCard);
                });
            } catch (error) {
                console.error(error);
            }
        }

        load_display();

        const buyIthem = (id, image, name, price, productID) => {
            const existingCartItem = cart.find(item => item.id === id);
            
            if (existingCartItem) {
                existingCartItem.quantity++;
            } else {
                cart.push({ id: id, quantity: 1, image: image, name: name, price: price });
            }

            localStorage.setItem("purchasedItems", JSON.stringify(cart));
            updateTotalPrice();
            updateCartContent();
            updateProductQuantity(productID);
        }

        const deleteIthem = (id, image, name, price, productID) => {
            const existingCartItem = cart.find(item => item.id === id);

            if (existingCartItem && existingCartItem.quantity > 0) {
                existingCartItem.quantity--;
                localStorage.setItem("purchasedItems", JSON.stringify(cart));
                updateTotalPrice();
                updateCartContent();
                updateProductQuantity(productID);
            }
        }

        const calculateTotalPrice = () => {
            let totalPrice = 0;

            for (const item of cart) {
                totalPrice += item.quantity * item.price;
            }

            return totalPrice;
        }
    
        const updateTotalPrice = () => {
            const totalPrice = calculateTotalPrice();
            const navbarTotalPriceElement = document.getElementById("navbar-total-price");
        
            if (navbarTotalPriceElement) {
                navbarTotalPriceElement.textContent = `Total Price: ${totalPrice}`;
            }
        }
        

        const calculateTotalQuantity = () => {
            let totalQuantity = 0;

            for (const item of cart) {
                totalQuantity += item.quantity;
            }

            return totalQuantity;
        }

        const updateProductQuantity = (productID) => {
            const product = cart.find(item => productID.includes(item.id));

            if (product) {
                const totalQuantityElement = document.getElementById(`total-quantity-${productID}`);
                
                if (totalQuantityElement) {
                    totalQuantityElement.textContent = product.quantity;
                }
            }
        }

        const updateCartContent = () => {
            const cartContent = document.querySelector(".cart-items");
            cartContent.innerHTML = ''; // Clear the existing content
            for (const item of cart) {
                const cartItem = document.createElement("div");
                cartItem.className = "cart-item";

                const itemImage = document.createElement("img");
                itemImage.src = item.image;
                itemImage.alt = item.name;
                itemImage.className = "product-image";

                const itemDetails = document.createElement("div");
                itemDetails.className = "product-details";
                itemDetails.innerHTML = `
                    <p>Name: ${item.name}</p>
                    <p>Price: ${item.price}</p>
                    <p>Quantity: ${item.quantity}</p>
                `;

                cartItem.appendChild(itemImage);
                cartItem.appendChild(itemDetails);
                cartContent.appendChild(cartItem);
            }
        }
        // פונקציה לטעינת הנתונים מ-LocalStorage
const loadCartFromLocalStorage = () => {
    const storedCart = localStorage.getItem("purchasedItems");

    if (storedCart) {
        cart.length = 0; 
        cart.push(...JSON.parse(storedCart)); 
        updateTotalPrice();
        updateCartContent();
    }
}
window.addEventListener('load', loadCartFromLocalStorage);




</script>
</body>
</html>
